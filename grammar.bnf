# --- Root ---
# A strategy MUST have an entry program. The exit program is optional.
# This aligns with the "Crawl" phase goal of finding long-only signal alpha.
<start> ::= <entry_program> <optional_exit>

# --- Program Definitions ---
<entry_program> ::= ENTRY <boolean_expr>
<exit_program>  ::= EXIT <boolean_expr>

# --- Optionality Wrapper ---
# Allows a strategy to have zero or one exit program.
<optional_exit> ::= | <exit_program>

# --- Expressions (Boolean Only for Program Logic) ---
<boolean_expr> ::= <arithmetic_expr> <arithmetic_expr> <comparator>
                 | <boolean_expr> <boolean_expr> <logical_op>
                 | <boolean_expr> NOT

<arithmetic_expr> ::= <operand>
                    | <arithmetic_expr> <arithmetic_expr> <arithmetic_op>

# --- Operators (Terminals) ---
<comparator> ::= GT | LT | GE | LE | EQ
<logical_op> ::= AND | OR
<arithmetic_op> ::= ADD | SUB | MUL | DIV_SAFE

# --- Operands (Data Terminals) ---
<operand> ::= <indicator> | <price> | <constant>
<indicator> ::= SMA20 | SMA100 | RSI14
<price> ::= OPEN | HIGH | LOW | CLOSE
<constant> ::= -1.0 | 0.0 | 1.0 | 30.0 | 50.0 | 70.0 | 100.0
